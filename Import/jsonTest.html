<html>
    <head>
        <script src="Import.js"></script>
        <link rel="Stylesheet" href = "Import.css">
        <link rel="Stylesheet" href = "dialog.css">
        <script>
            var obj = {
                "fields" : 
                [
                    { "label" : "EnrollmentNo","type" : "int(9)"},
                    { "label" : "RollNo","type" : "char(30)"},
                    { "label" : "Name","type" : "varchar(30)"},
                    { "label" : "SGPA","type" : "float(4,2)"}
                ],
                "data" : 
                [
                    ["143210001","U14051","Ankita Agarwala","8.33"],
                    ["143210002","U14247","Arkadeep Nath","8.67"],
                    ["143210004","U14398","Indranil Sharma","9.00"],
                    ["143210005","U14412","Lina Bora","9.00"],
                    ["143210006","U14029","Pallavi Goswami","9.33"],
                    ["143210008","U14310","Swapnil Bhattacharjee","9.00"],
                    ["143210009","U14388","Sudeshna Chakroborty","8.67"],
                ]
            };
            
            var attr = function(field,type,len) {
                this.field = field;
                this.type = type;
                this.len = len;
                this.unique = "test";
				this.values = [];

                this.setUnique = function(uni) {
                    this.unique = uni;
                };
            };

            function findAttribute() {
                if(obj.hasOwnProperty('fields') && obj.hasOwnProperty('data')) {
                    var attributes = [];
                    var fields = obj.fields;
                    for(var i = 0; i < fields.length; i++) {
                        var field = fields[i].label;
                        var dataType = fields[i].type;
                        var len = -1;
                        var type = dataType.split("(")[0];
                        if(dataType.indexOf("(") > -1) {
                            len = dataType.split("(")[1].split(")")[0];
                        }
                        attributes.push(new attr(field,type,len));
                    }

                    var data = obj.data;
                    if(fields.length == data[0].length) {
                        for(var i = 0; i < data.length; i++) {
                            for(var j = 0; j < fields.length; j++) {
                                if(attributes[j].unique == "test") {
                                    attributes[j].setUnique(true);
									attributes[j].values.push(data[i][j]);
									
                                }
                                else if(attributes[j].unique) {
                                    if(attributes[j].values.indexOf(data[i][j]) > -1) {
                                        attributes[j].setUnique(false);
                                    }
									else {
										attributes[j].values.push(data[i][j]);
									}
                                }
                            }
                        }
                        buildTable(attributes);
                    }
                    else {
                        document.getElementsByTagName('div')[0].innerHTML = "<div class = \"newBody\" align = \"center\"><h4 style = \"font-family : 'Lucida Calligraphy', Serif; text-align : left !important; color : red\">The transfer of Data from the excel document to the SQL Table because some rows in the table had illegal values, incompatible with standard SQL datatypes.<br> This table cannot be imported. Sorry!</h4></div>";
                        return false;
                    }
                }
                else {
                    document.getElementsByTagName('div')[0].innerHTML = "<div class = \"newBody\" align = \"center\"><h4 style = \"font-family : 'Lucida Calligraphy', Serif; text-align : left !important; color : red\">The transfer of Data from the excel document to the SQL Table because some rows in the table had illegal values, incompatible with standard SQL datatypes.<br> This table cannot be imported. Sorry!</h4></div>";
                    return false;
                }
            }

            function buildTable(attributes) {
                var div1 = document.getElementsByTagName('div')[0];
                var select = "<optgroup label=\"Numeric\"><option value = \"tinyint\">TINYINT</option>"
                    + "<option value = \"smallint\">SMALLINT</option><option value = \"mediumint\">MEDIUMINT</option><option value = \"int\">INT</option>"
                    + "<option value = \"bigint\">BIGINT</option><option value = \"numeric\">NUMERIC</option><option value = \"double\">DOUBLE</option>"
                    + "<option value = \"bit\">BIT</option><option value = \"boolean\">BOOLEAN</option></optgroup><optgroup label=\"Date and time\">"
                    + "<option value = \"date\">DATE</option><option value = \"datetime\">DATETIME</option><option value = \"timestamp\">TIMESTAMP</option>"
                    + "<option value = \"time\">TIME</option><option value = \"year\">YEAR</option></optgroup><optgroup label=\"String\"><option value = \"char\">CHAR</option>"
                    + "<option value = \"varchar\">VARCHAR</option><option value = \"text\">TEXT</option><option value = \"blob\">BLOB</option></optgroup>";
                
                var uni = "<option value = 'unique'>UNIQUE</option>"
                    + "<option value = 'primary key'>PRIMARY KEY</option>";

                var html = "<h3>Confirm the attribute specification for the Table : "+div1.getAttribute('data-tab')+", of Database : "+div1.getAttribute('data-db')+"</h3>";

                html += "<table><tr class = \"b\"><th>Field</th><th>Type</th><th>Length</th><th>Null</th><th>Key</th></tr>"
                for(var i = 0; i < attributes.length; i++) {
                    html += "<tr>";
                    html += "<td><input type = \"text\" value = \""+attributes[i].field+"\" data-def = \""+attributes[i].field+"\"></td>";
                    html += "<td><select><option value = \""+attributes[i].type+"\">"+attributes[i].type.toLocaleUpperCase()+"</option>"+select+"</select></td>";
                    html += "<td><input type = 'text' value = \""+attributes[i].len+"\" data-def = \""+attributes[i].len+"\"></td>";
                    html += "<td><input type = 'checkbox' checked = 'checked'></td>";
                    html += "<td><select>"+(attributes[i].unique == true ? uni + "<option value = 'none'>NONE</option>" : "<option value = 'none'>NONE</option>" + uni)+"</select></td>";
                    html += "</tr>"
                    console.log("attributes["+i+"].field = "+attributes[i].field);
                    console.log("attributes["+i+"].type = "+attributes[i].type);
                    console.log("attributes["+i+"].len = "+attributes[i].len);
                    console.log("attributes["+i+"].unique = "+attributes[i].unique);
                }
                html += "</table>";
                html += "<button class = \"button\">Proceed</button>";
                html += "<button class = \"resetButton\" onclick = \"reset()\">Reset</button>";
                div1.innerHTML = html;
                var button = document.getElementsByClassName('button')[0];
                button.addEventListener("click",function(){
                    //console.log(obj.data);
                    go(obj.data);
                });
            } 
        </script>
    </head>
    <body onload = "findAttribute()">
        <div align = "center" data-tab = 'class' data-db = 'forum'>

        </div>
        <div align = "center" id = "dialog" style = 'display : none;'>
			<div class = "modal-content">
				<div id = "message" style = "text-align : left !important">A null value cannot be accepted for this column</div>
				<button class="dia-button" onclick = "this.parentElement.parentElement.style.display = 'none';">OK</button>
			</div>
		</div>
    </body>
</html>